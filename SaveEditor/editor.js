var n={},i=document.getElementById("editor"),X=document.getElementById("nonwipemask"),E=i.getContext("2d"),A=document.getElementById("nonwipemask").getContext("2d"),le=document.getElementById("transparent"),C=document.getElementById("transparent").getContext("2d"),de=[],oe=0,j=60,ae=0,fe=new Date().getTime(),B=1,$=0,g={OS:!1,OL:!0,RR:!1,TT:!0,TH:!0,DW:!1,RQ:4};function ke(){requestAnimationFrame(ve)}if(localStorage.getItem("settings"))try{g=JSON.parse(localStorage.getItem("settings"))}catch{localStorage.setItem("settings",JSON.stringify(g))}else localStorage.setItem("settings",JSON.stringify(g));g||(g={});g.OS||(g.OS=!1);g.OL||(g.OL=!0);g.RR||(g.RR=!1);g.TT||(g.TT=!0);g.TH||(g.TH=!0);g.DW||(g.DW=!1);g.RQ||(g.RQ=4);localStorage.setItem("settings",JSON.stringify(g));var W=[],re=[],Y=[],Ee=10,e=3,pe=0,ge=.5,he=!1,a=[0,0],_=!1,ee=!1,ce=!1,ne=!1,S=[-1,-1],w=5,I=1,p=1,R=0;C.globalAlpha=.1;function Se(t){alert(t)}function ve(){Be()}async function q(t){try{let o=await new Promise((c,d)=>{t.toBlob(c,"image/png")}),r=new ClipboardItem({"image/png":o});await navigator.clipboard.write([r])}catch(o){alert("failed: "+o)}}function U(t){var o=t.toDataURL(),r=document.createElement("a");r.download="canvas_image.png",r.href=o,r.click()}function we(t){t&&R>0&&(R==1&&document.getElementById("fw")&&(t==1?U(document.getElementById("fw")):t==2&&q(document.getElementById("fw"))),R==2&&document.getElementById("lw")&&(t==1?U(document.getElementById("lw")):t==2&&q(document.getElementById("lw"))),R==3&&document.getElementById("sw")&&(t==1?U(document.getElementById("sw")):t==2&&q(document.getElementById("sw"))),R==4&&document.getElementById("aw")&&(t==1?U(document.getElementById("aw")):t==2&&q(document.getElementById("aw"))),R==5&&document.getElementById("ft")&&(t==1?U(document.getElementById("ft")):t==2&&q(document.getElementById("ft"))))}document.getElementById("loadFS").onchange=()=>{be(document.getElementById("loadFS"))};document.getElementById("backgroundGrabber").onchange=()=>{be(document.getElementById("backgroundGrabber"))};async function be(t){if(t.files[0]){var o=new FileReader;o.readAsText(t.files[0]),o.onload=r=>{try{he=!0,n={saveData:JSON.parse(r.target.result.split(`\n`)[0]),worldData:JSON.parse(r.target.result.split(`\n`)[1])},document.getElementById("menu").style.display="none",document.getElementById("ac").style.display="none",g.DW||(document.getElementById("helper").innerText="Welcome, use RMB or MMB to move the camera, or use LMB with the move tool.",document.getElementById("helper").style.top="8vh",setTimeout(()=>{document.getElementById("helper").style.top="0vh",setTimeout(()=>{document.getElementById("helper").innerText="Theres an array of tools at the top,hover on a tool to get more info,fullscreen recommended(f11)",document.getElementById("helper").style.top="8vh",setTimeout(()=>{document.getElementById("helper").style.top="0vh"},5e3)},700)},1e4))}catch(c){Se(c)}},o.onerror=()=>{alert("failed to read")}}}var Me={0:"Empty",1:"Element",2:"SandSoil",3:"SporeSoil",4:"Fog",5:"FogJetpackBlock",6:"FogWater",7:"FreezingIceSoil",8:"Divider",9:"Grass",10:"Moss",11:"GoldSoil",12:"Petal",13:"FogLava",14:"Fluxite",15:"Block",16:"SlidingBlock",23:"Bedrock",25:"Ice",26:"Grower",27:"NascentWater",28:"SandiumSoil",29:"Obsidian",30:"Crackstone"},l={blockTexts:{Empty:"rgba(0,0,0,0)",Element:"rgb(255, 0, 0)",SandSoil:"rgb(210,167,106)",SporeSoil:"rgb(119,147,37)",Fog:"rgb(102,204,255)",FogJetpackBlock:"rgb(0, 13, 255)",FogWater:"rgb(154, 240, 253)",FreezingIceSoil:"rgb(238,246,246)",Divider:"rgb(255, 128, 0)",Grass:"rgb(115,177,67)",Moss:"rgb(91,206,34)",GoldSoil:"rgb(255, 255, 0)",Petal:"rgb(70,37,147)",FogLava:"rgb(184, 70, 70)",Fluxite:"rgb(184, 18, 239)",Block:"rgb(194, 200, 34)",SlidingBlock:"rgb(217, 255, 0)",SlidingBlockLeft:"rgb(255, 0, 238)",SlidingBlockRight:"rgb(0, 255, 195)",ConveyorLeft:"rgb(61, 43, 43)",ConveyorRight:"rgb(84, 93, 58)",ShakerLeft:"rgb(97, 88, 88)",ShakerRight:"rgb(97, 88, 88)",Bedrock:"rgb(168,168,168)",VelocitySoaker:"rgb(107, 120, 49)",Ice:"rgb(204,239,255)",Grower:"rgb(124, 91, 19)",NascentWater:"rgb(0, 242, 247)",SandiumSoil:"rgb(163,0,0)",Obsidian:"rgb(77,0,0)",Crackstone:"rgb(224,211,184)",Slag:"rgb(126, 126, 126)",BurntSlag:"rgb(57, 57, 57)",BGWater:"rgb(65, 115, 252)"},particleTexts:{Sand:"rgb(255, 207, 86)",Particle:"rgb(0,0,0)",Water:"rgb(10, 250, 238)",WetSand:"rgb(184,126,46)",Sandium:"rgb(215, 24, 24)",Slag:"rgb(126, 126, 126)",Gold:"rgb(239, 224, 11)",Gloom:"rgb(0, 210, 186)",Shake:"rgb(255, 128, 0)",Steam:"rgba(31, 166, 144, 0.42)",Fire:"rgb(234, 131, 5)",FreezingIce:"rgb(41, 181, 213)",Flame:"rgb(215, 62, 15)",BurntSlag:"rgb(56, 56, 56)",Spore:"rgb(97, 200, 116)",WetSpore:"rgb(30, 133, 49)",Seed:"rgb(102, 74, 22)",Petalium:"rgb(135, 20, 181)",Lava:"rgb(235, 19, 19)",Basalt:"rgb(39, 33, 33)"},tileImages:{player:{img:"./tiles/player",width:18,height:34},block:{img:"./tiles/block",width:4,height:4},ConveyorLeft:{img:"./tiles/conveyor_left",width:16,height:16,tiles:[4,0]},ConveyorRight:{img:"./tiles/conveyor_right",width:16,height:16,tiles:[4,0]},ShakerLeft:{img:"./tiles/shaker_left",width:16,height:22,tiles:[2,0]},ShakerRight:{img:"./tiles/shaker_right",width:16,height:22,tiles:[2,0]},LauncherUp:{img:"./tiles/launcher",width:18,height:18},LauncherLeft:{img:"./tiles/launcher_left",width:18,height:26,yScaler:1.4444444444},LauncherRight:{img:"./tiles/launcher_right",width:18,height:26,yScaler:1.444444444},SplitterLeft:{img:"./tiles/splitter_left",width:7,height:4},SplitterRight:{img:"./tiles/splitter_right",width:7,height:4},Foundation:{img:"./tiles/block",width:4,height:4},FoundationAngledLeft:{img:"./tiles/triangle_left",width:4,height:4},FoundationTriangleLeftDel:{img:"./tiles/triangle_left_del",width:4,height:4},FoundationAngledRight:{img:"./tiles/triangle_right",width:4,height:4},FoundationTriangleRightDel:{img:"./tiles/triangle_right_del",width:4,height:4},Collector:{img:"./tiles/sell",width:16,height:16,tiles:[4,0],opacity:1},FilterLeft:{img:"./tiles/filter_left",width:18,height:18,tiles:[4,0]},FilterRight:{img:"./tiles/filter_right",width:18,height:18,tiles:[4,0]},VelocitySoaker:{img:"./tiles/velocity",width:18,height:417,yScaler:23.166666666666,opacity:.3},Grower:{img:"./tiles/farm",width:18,height:18},SoundBox:{img:"./tiles/sound_box",width:16,height:16},Pump:{img:"./tiles/pump",width:16,height:16},LiquidVent:{img:"./tiles/liquid_vent",width:16,height:16},Light:{img:"./tiles/light",width:16,height:16},GloomEmitter:{img:"./tiles/gloom_emitter",width:16,height:16},BackGround:{img:"./tiles/mountains_tiling_4x",width:3963,height:1024}},blocks:{0:"Empty",1:"Element",2:"SandSoil",3:"SporeSoil",4:"Fog",5:"FogJetpackBlock",6:"FogWater",7:"FreezingIceSoil",8:"Divider",9:"Grass",10:"Moss",11:"GoldSoil",12:"Petal",13:"FogLava",14:"Fluxite",15:"Block",16:"SlidingBlock",17:"SlidingBlockLeft",18:"SlidingBlockRight",19:"ConveyorLeft",20:"ConveyorRight",21:"ShakerLeft",22:"ShakerRight",23:"Bedrock",24:"VelocitySoaker",25:"Ice",26:"Grower",27:"NascentWater",28:"SandiumSoil",29:"Obsidian",30:"Crackstone"},particles:{1:"Sand",2:"Particle",3:"Water",4:"WetSand",5:"Sandium",6:"Slag",7:"Gold",8:"Gloom",9:"Shake",10:"Steam",11:"Fire",12:"FreezingIce",13:"Flame",14:"BurntSlag",15:"Spore",16:"WetSpore",17:"Seed",18:"Petalium",19:"Lava",20:"Basalt"},structures:{1:"ConveyorLeft",2:"ConveyorRight",3:"ShakerLeft",4:"ShakerRight",5:"LauncherUp",6:"LauncherLeft",7:"LauncherRight",8:"SplitterLeft",9:"SplitterRight",10:"Dropper",11:"Foundation",12:"FoundationAngledLeft",13:"FoundationTriangleLeftDel",14:"FoundationAngledRight",15:"FoundationTriangleRightDel",16:"Collector",17:"FilterLeft",18:"FilterRight",19:"SlidingFoundation",20:"VelocitySoaker",21:"Grower",22:"SoundBox",23:"Pipe",24:"Pump",25:"LiquidVent",26:"Light",27:"GloomEmitter"}},T={blockTexts:{Empty:"rgb(255,255,255)",Element:"rgb(0,0,0)",SandSoil:"rgb(0,0,0)",SporeSoil:"rgb(255,255,0)",Fog:"rgb(153,51,0)",FogJetpackBlock:"rgb(255,0,153)",FogWater:"rgb(153,102,255)",FreezingIceSoil:"rgb(204,255,255)",Divider:"rgb(0,102,0)",Grass:"rgb(0,255,0)",Moss:"rgb(0,224,0)",GoldSoil:"rgb(0,0,0)",Petal:"rgb(0,0,0)",FogLava:"rgb(0,0,0)",Fluxite:"rgb(175,0,224)",Block:"rgb(0,0,0)",SlidingBlock:"rgb(0,0,0)",SlidingBlockLeft:"rgb(0,0,0)",SlidingBlockRight:"rgb(0,0,0)",ConveyorLeft:"rgb(0,0,0)",ConveyorRight:"rgb(0,0,0)",ShakerLeft:"rgb(0,0,0)",ShakerRight:"rgb(0,0,0)",Bedrock:"rgb(170,170,170)",VelocitySoaker:"rgb(0,0,0)",Ice:"rgb(102,204,255)",Grower:"rgb(0,0,0)",NascentWater:"rgb(0,0,0)",SandiumSoil:"rgb(0,0,0)",Obsidian:"rgb(0,0,0)",Crackstone:"rgb(205,109,109)",Slag:"rgb(0,0,0)",BurntSlag:"rgb(0,0,0)",BGWater:"rgb(0,0,0)"},particleTexts:{Sand:"rgb(218,171,105)",Particle:"rgb(0,0,0)",Water:"rgb(102,0,255)",WetSand:"rgb(186,127,46)",Sandium:"rgb(188,33,33)",Slag:"rgb(174,174,174)",Gold:"rgb(250,250,2)",Gloom:"rgb(103,102,102)",Shake:"rgb()",Steam:"rgb(255,255,204)",Fire:"rgb()",FreezingIce:"rgb(204,204,204)",Flame:"rgb()",BurntSlag:"rgb(98,98,98)",Spore:"rgb(190,218,105)",WetSpore:"rgb(150,186,46)",Seed:"rgb(70,153,26)",Petalium:"rgb(139,105,218)",Lava:"rgb(255,174,11)",Basalt:"rgb(117,10,0)"},tileImages:{player:{img:"./tiles/player",width:18,height:34},block:{img:"./tiles/block",width:4,height:4},ConveyorLeft:{img:"./tiles/conveyor_left",width:16,height:16,tiles:[4,0]},ConveyorRight:{img:"./tiles/conveyor_right",width:16,height:16,tiles:[4,0]},ShakerLeft:{img:"./tiles/shaker_left",width:16,height:22,tiles:[2,0]},ShakerRight:{img:"./tiles/shaker_right",width:16,height:22,tiles:[2,0]},LauncherUp:{img:"./tiles/launcher",width:18,height:18},LauncherLeft:{img:"./tiles/launcher_left",width:18,height:26,yScaler:1.4444444444},LauncherRight:{img:"./tiles/launcher_right",width:18,height:26,yScaler:1.444444444},SplitterLeft:{img:"./tiles/splitter_left",width:7,height:4},SplitterRight:{img:"./tiles/splitter_right",width:7,height:4},Foundation:{img:"./tiles/block",width:4,height:4},FoundationAngledLeft:{img:"./tiles/triangle_left",width:4,height:4},FoundationTriangleLeftDel:{img:"./tiles/triangle_left_del",width:4,height:4},FoundationAngledRight:{img:"./tiles/triangle_right",width:4,height:4},FoundationTriangleRightDel:{img:"./tiles/triangle_right_del",width:4,height:4},Collector:{img:"./tiles/sell",width:16,height:16,tiles:[4,0],opacity:1},FilterLeft:{img:"./tiles/filter_left",width:18,height:18,tiles:[4,0]},FilterRight:{img:"./tiles/filter_right",width:18,height:18,tiles:[4,0]},VelocitySoaker:{img:"./tiles/velocity",width:18,height:417,yScaler:23.166666666666,opacity:.3},Grower:{img:"./tiles/farm",width:18,height:18},SoundBox:{img:"./tiles/sound_box",width:16,height:16},Pump:{img:"./tiles/pump",width:16,height:16},LiquidVent:{img:"./tiles/liquid_vent",width:16,height:16},Light:{img:"./tiles/light",width:16,height:16},GloomEmitter:{img:"./tiles/gloom_emitter",width:16,height:16}},blocks:{0:"Empty",1:"Element",2:"SandSoil",3:"SporeSoil",4:"Fog",5:"FogJetpackBlock",6:"FogWater",7:"FreezingIceSoil",8:"Divider",9:"Grass",10:"Moss",11:"GoldSoil",12:"Petal",13:"FogLava",14:"Fluxite",15:"Block",16:"SlidingBlock",17:"SlidingBlockLeft",18:"SlidingBlockRight",19:"ConveyorLeft",20:"ConveyorRight",21:"ShakerLeft",22:"ShakerRight",23:"Bedrock",24:"VelocitySoaker",25:"Ice",26:"Grower",27:"NascentWater",28:"SandiumSoil",29:"Obsidian",30:"Crackstone"},particles:{1:"Sand",2:"Particle",3:"Water",4:"WetSand",5:"Sandium",6:"Slag",7:"Gold",8:"Gloom",9:"Shake",10:"Steam",11:"Fire",12:"FreezingIce",13:"Flame",14:"BurntSlag",15:"Spore",16:"WetSpore",17:"Seed",18:"Petalium",19:"Lava",20:"Basalt"},structures:{1:"ConveyorLeft",2:"ConveyorRight",3:"ShakerLeft",4:"ShakerRight",5:"LauncherUp",6:"LauncherLeft",7:"LauncherRight",8:"SplitterLeft",9:"SplitterRight",10:"Dropper",11:"Foundation",12:"FoundationAngledLeft",13:"FoundationTriangleLeftDel",14:"FoundationAngledRight",15:"FoundationTriangleRightDel",16:"Collector",17:"FilterLeft",18:"FilterRight",19:"SlidingFoundation",20:"VelocitySoaker",21:"Grower",22:"SoundBox",23:"Pipe",24:"Pump",25:"LiquidVent",26:"Light",27:"GloomEmitter"}},Ie=[5,6,7,11,12,13,14,15,20,24,25,26],z={p:{12:"Ice/Frozen Water",14:"Burnt Slag",16:"Wet Spore",13:"Fire",4:"Wet Sand"},b:{0:"Air",5:"JetPack BG",2:"Sand Soil",3:"Spore Soil",6:"Hazy Water",7:"Snow",11:"Golden Soil",13:"Hazy Lava",14:"Flux/Fluxite",16:"Sliding Block",17:"Sliding Block (Left)",18:"Sliding Block (Right)",19:"Conveyor (Left)",20:"Conveyor (Right)",21:"Shaker (Left)",22:"Shaker (Right)",24:"Kinematic Press",27:"Nascent Water",28:"Sandium Soil"}};Object.keys(l.tileImages).forEach(t=>{var o=new Image;o.src=l.tileImages[t].img+".png",l.tileImages[t].img=o});var Z=0;Object.keys(l.blocks).forEach(t=>{Z=Math.max(Z,t)});function Q(t,o=l){var r=o.blockTexts[o.blocks[t]];if(r||(r=o.particleTexts[o.particles[t-100]]),typeof t=="object")if(Array.isArray(t)){var c={r:[],g:[],b:[],a:[]};t.forEach(u=>{var f=o.blockTexts[o.blocks[u]];f||(f=o.particleTexts[o.particles[u-100]]),typeof f=="string"&&f.startsWith("rgba")?(c.r.push(parseFloat(f.substring(5,f.length-1).split(",")[0])),c.g.push(parseFloat(f.substring(5,f.length-1).split(",")[1])),c.b.push(parseFloat(f.substring(5,f.length-1).split(",")[2])),c.a.push(parseFloat(f.substring(5,f.length-1).split(",")[3]))):(c.r.push(parseFloat(f.substring(5,f.length-1).split(",")[0])),c.g.push(parseFloat(f.substring(5,f.length-1).split(",")[1])),c.b.push(parseFloat(f.substring(5,f.length-1).split(",")[2])),c.a.push(1))});var[d,h,m,M]=[0,0,0,0];c.r.map(u=>{d+=u||0}),d/=c.r.length,c.g.map(u=>{h+=u||0}),h/=c.g.length,c.b.map(u=>{m+=u||0}),m/=c.b.length,c.a.map(u=>{M+=u||1}),M/=c.a.length,r="rgba("+d+","+h+","+m+","+M+")"}else t=t.element.type,r=o.particleTexts[o.particles[t]];return r}function V(){if(de=[],n.worldData){E.clearRect(0,0,i.width,i.height),C.clearRect(0,0,i.width,i.height);var t=performance.now();g.OS||n.worldData.world.matrix.forEach((o,r)=>{var c=0,d=null,h=0;if(o.forEach((M,u)=>{if(M!=0){g.OL&&g.RQ>2&&(C.fillStyle="rgba(0, 0, 0, 0.5)",n.worldData.world.matrix[r-1]&&n.worldData.world.matrix[r-1][u]==0&&C.fillRect(u*e,(r-1)*e+e*.75,e,e/4),n.worldData.world.matrix[r+1]&&n.worldData.world.matrix[r+1][u]==0&&C.fillRect(u*e,(r+1)*e+e/8,e,e/4),n.worldData.world.matrix[r]&&n.worldData.world.matrix[r][u-1]==0&&C.fillRect((u-1)*e+e*.75,r*e,e/4,e),n.worldData.world.matrix[r]&&n.worldData.world.matrix[r][u+1]==0&&C.fillRect((u+1)*e+e/8,r*e,e/4,e));var f=Q(M);if(u<o.length)if(typeof M=="number"&&(d==null||d==M)){c++,d==null&&(d=M,h=u);return}else{var F=l.blockTexts[l.blocks[d]];F||(F=l.particleTexts[l.particles[d-100]]),E.fillStyle=F,E.fillRect(h*e,r*e,e*c,e),d=null,c=0}M!=0&&(E.fillStyle=f,E.fillRect(u*e,r*e,e,e))}else if(d!=null){var F=l.blockTexts[l.blocks[d]];F||(F=l.particleTexts[l.particles[d-100]]),E.fillStyle=F,E.fillRect(h*e,r*e,e*c,e),d=null,c=0}}),d!=null){var m=l.blockTexts[l.blocks[d]];m||(m=l.particleTexts[l.particles[d-100]]),E.fillStyle=m,E.fillRect(h*e,r*e,e*c,e)}}),n.worldData.structures.forEach(o=>{l.structures[o.type]&&l.tileImages[l.structures[o.type]]&&(Ie.includes(o.type)?E.drawImage(l.tileImages[l.structures[o.type]].img,l.tileImages[l.structures[o.type]].width*(Math.floor(oe/j/ge)%(l.tileImages[l.structures[o.type]].tiles||[1,0])[0]),0,l.tileImages[l.structures[o.type]].width,l.tileImages[l.structures[o.type]].height,o.x*e,o.y*e,4*e*(l.tileImages[l.structures[o.type]].xScaler||1),4*e*(l.tileImages[l.structures[o.type]].yScaler||1)):(E.drawImage(l.tileImages[l.structures[o.type]].img,l.tileImages[l.structures[o.type]].width*(Math.floor(oe/j/ge)%(l.tileImages[l.structures[o.type]].tiles||[1,0])[0]),0,l.tileImages[l.structures[o.type]].width,l.tileImages[l.structures[o.type]].height,o.x*e,o.y*e,4*e*(l.tileImages[l.structures[o.type]].xScaler||1),4*e*(l.tileImages[l.structures[o.type]].yScaler||1)),de.push({type:1,struct:o})))}),document.getElementById("RL").innerText=Math.floor(performance.now()-t)+"ms",setTimeout(()=>{document.getElementById("RL").innerText="Refresh Viewport"},1500)}}var[P,G]=[0,0];function me(t){if(n.worldData){if(A.clearRect(0,0,X.width,X.height),_&&A.drawImage(l.tileImages.player.img,Math.round((-a[0]+P)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e)*e),Math.round((-a[1]+G)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e)*e),l.tileImages.player.width,l.tileImages.player.height),A.drawImage(l.tileImages.player.img,n.worldData.player.x*e/8,n.worldData.player.y*e/8,18/4*e,34/4*e),(I==2||I==4)&&!_&&document.getElementById("ac").style.display=="none"&&document.getElementById("blockPicker").style.display=="none"){A.fillStyle="rgba(0,0,0,1)",A.strokeRect(Math.round((-a[0]+P)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e)*e)-e*w/2,Math.round((-a[1]+G)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e)*e)-e*w/2,e*w,e*w);var o="rgba(",r=l.blockTexts[l.blocks[p]];o+=parseFloat(r.replaceAll("rgba(","").replaceAll("rgb(","").substring(0,r.length-1).split(",")[0])+",",o+=parseFloat(r.replaceAll("rgba(","").replaceAll("rgb(","").substring(0,r.length-1).split(",")[1])+",",o+=parseFloat(r.replaceAll("rgba(","").replaceAll("rgb(","").substring(0,r.length-1).split(",")[2])+",",A.fillStyle=o+"0.5)",A.fillRect(Math.round((-a[0]+P)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e)*e)-e*w/2,Math.round((-a[1]+G)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e)*e)-e*w/2,e*w,e*w);var c=p;if(I==4&&(p=0),ne&&t){if($=new Date().getTime(),t){let u=J[0],f=J[1],F=P-u,s=G-f,v=Math.abs(F)/1,b=Math.abs(s)/1,y=F!==0?1*Math.sign(F):0,L=s!==0?1*Math.sign(s):0,D=Math.max(v,b);for(let k=0;k<=D;k++){var h=Math.round(Math.round((-a[0]+u)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e))-w/2),m=Math.round(Math.round((-a[1]+f)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e))-w/2);for(let N=m;N<m+w;N++)for(let K=h;K<h+w;K++)if(K>=0&&N>=0&&K<n.worldData.world.matrix[0].length&&N<n.worldData.world.matrix.length){var d=!1;if(Y.forEach(ye=>{ye[0]==K&&ye[1]==N&&(d=!0)}),d)continue;Y.push([K,N,n.worldData.world.matrix[N][K]]),n.worldData.world.matrix[N][K]=p}var M=Q(p);p==0&&(M="rgb(127,255,212)"),E.fillStyle=M,E.fillRect(h*e,m*e,e*w,e*w),g.OL&&C.clearRect(h*e,m*e,e*w,e*w),I==4&&(p=c),k<=v&&(u+=y),k<=b&&(f+=L)}}var h=Math.round(Math.round((-a[0]+P)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e))-w/2),m=Math.round(Math.round((-a[1]+G)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e))-w/2);for(let u=m;u<m+w;u++)for(let f=h;f<h+w;f++)if(f>=0&&u>=0&&f<n.worldData.world.matrix[0].length&&u<n.worldData.world.matrix.length){var d=!0;Y.forEach(s=>{s[0]==f&&s[1]==u&&(d=!1)}),d&&Y.push([f,u,n.worldData.world.matrix[u][f]]),n.worldData.world.matrix[u][f]=p}var M=Q(p);p==0&&(M="rgb(127,255,212)"),E.fillStyle=M,E.fillRect(h*e,m*e,e*w,e*w),g.OL&&C.clearRect(h*e,m*e,e*w,e*w),I==4&&(p=c)}}I==3&&ne&&(A.fillStyle="rgba(0,0,0,1)",A.strokeRect(Math.round(Math.round((-a[0]+S[0])/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e)))*e,Math.round(Math.round((-a[1]+S[1])/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e)))*e,(Math.round(Math.round((-a[0]+P)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e)))-Math.round(Math.round((-a[0]+S[0])/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e))))*e,(Math.round(Math.round((-a[1]+G)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e)))-Math.round(Math.round((-a[1]+S[1])/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e))))*e))}}addEventListener("mousemove",t=>{if(n.worldData){var o="None";if(n.worldData.world.matrix[Math.round((-a[1]+t.clientY)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e))]&&n.worldData.world.matrix[Math.round((-a[1]+t.clientY)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e))][Math.round((-a[0]+t.clientX)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e))]){var r=n.worldData.world.matrix[Math.round((-a[1]+t.clientY)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e))][Math.round((-a[0]+t.clientX)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e))];typeof r=="number"?r>100?l.particles[r-100]&&(o=z.p[r-100]||l.particles[r-100]):l.blocks[r]&&(o=z.b[r]||l.blocks[r]):typeof r=="object"&&(Array.isArray(r)?o="Overlapping Blocks":r&&(r.element.type>100?l.particles[r.element.type-100]&&(o="Launched "+(z.p[r.element.type-100]||l.particles[r.element.type-100])):l.blocks[r.element.type]&&(o="Launched "+(z.p[r.element.type]||l.particles[r.element.type]))))}document.getElementById("ToolTip").innerText="X:"+Math.round((-a[0]+t.clientX)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e))+",Y:"+Math.round((-a[1]+t.clientY)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e))+`\nBlock:`+o}});var ue=!1,J=[];function se(){document.getElementById("editor").style.left=a[0]+"px",document.getElementById("editor").style.top=a[1]+"px",document.getElementById("nonwipemask").style.left=a[0]+"px",document.getElementById("nonwipemask").style.top=a[1]+"px",document.getElementById("transparent").style.left=a[0]+"px",document.getElementById("transparent").style.top=a[1]+"px"}addEventListener("mousedown",t=>{t.buttons==1&&R>0&&we(1),t.buttons==2&&R>0&&we(2),t.buttons==1&&t.clientY/window.innerHeight>=.08&&!_&&(ne=!0,S=[t.clientX,t.clientY]),(I==1&&t.buttons==1||t.buttons==4||t.buttons==2)&&document.getElementById("ac").style.display=="none"&&(t.preventDefault(),J=[t.clientX,t.clientY],ue=!0),t.buttons==1&&_&&(_=!1,n.worldData.player.x=Math.round((-a[0]+t.clientX)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e))*8,n.worldData.player.y=Math.round((-a[1]+t.clientY)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e))*8,n.worldData.player.velocity.x=0,n.worldData.player.velocity.y=0),P=t.clientX,G=t.clientY,J=[t.clientX,t.clientY],(I==2||I==4)&&me(!0)});addEventListener("mouseup",t=>{if(I==2&&t.button==0&&Y.length>0&&(re.push({type:"brush",r:Y}),Y=[],re.length>Ee&&re.shift()),I==3&&t.button==0&&t.clientY/window.innerHeight>.08&&S[0]>=0&&S[1]>=0){$=new Date().getTime(),E.fillStyle=Q(p);var o=Math.round(Math.round((-a[0]+S[0])/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e))),r=Math.round(Math.round((-a[1]+S[1])/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e))),c=Math.round(Math.round((-a[0]+P)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e)))-Math.round(Math.round((-a[0]+S[0])/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e))),d=Math.round(Math.round((-a[1]+G)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e)))-Math.round(Math.round((-a[1]+S[1])/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e)));if(r>r+d&&o<o+c)for(let h=r;h>r+d;h--)for(let m=o;m<o+c;m++)m>=0&&h>=0&&m<n.worldData.world.matrix[0].length&&h<n.worldData.world.matrix.length&&(n.worldData.world.matrix[h][m]=p);else if(o>o+c&&r<r+d)for(let h=r;h<r+d;h++)for(let m=o;m>o+c;m--)m>=0&&h>=0&&m<n.worldData.world.matrix[0].length&&h<n.worldData.world.matrix.length&&(n.worldData.world.matrix[h][m]=p);else if(o>o+c&&r>r+d)for(let h=r;h>r+d;h--)for(let m=o;m>o+c;m--)m>=0&&h>=0&&m<n.worldData.world.matrix[0].length&&h<n.worldData.world.matrix.length&&(n.worldData.world.matrix[h][m]=p);else for(let h=r;h<r+d;h++)for(let m=o;m<o+c;m++)m>=0&&h>=0&&m<n.worldData.world.matrix[0].length&&h<n.worldData.world.matrix.length&&(n.worldData.world.matrix[h][m]=p);g.OL&&C.clearRect(Math.round(Math.round((-a[0]+S[0])/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e)))*e,Math.round(Math.round((-a[1]+S[1])/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e)))*e,(Math.round(Math.round((-a[0]+P)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e)))-Math.round(Math.round((-a[0]+S[0])/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e))))*e,(Math.round(Math.round((-a[1]+G)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e)))-Math.round(Math.round((-a[1]+S[1])/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e))))*e),E.fillRect(Math.round(Math.round((-a[0]+S[0])/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e)))*e,Math.round(Math.round((-a[1]+S[1])/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e)))*e,(Math.round(Math.round((-a[0]+P)/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e)))-Math.round(Math.round((-a[0]+S[0])/parseFloat(i.style.width.substring(0,i.style.width.length-2))*Math.floor(i.width/e))))*e,(Math.round(Math.round((-a[1]+G)/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e)))-Math.round(Math.round((-a[1]+S[1])/parseFloat(i.style.height.substring(0,i.style.height.length-2))*Math.floor(i.height/e))))*e)}t.button==0&&(ne=!1,S=[-1,-1]),(I==1||t.button!=0)&&(ue=!1)});addEventListener("mousemove",t=>{if(P=t.clientX,G=t.clientY,(I==2||I==4)&&me(!0),ue){var o=[J[0]-t.clientX,J[1]-t.clientY];a[0]-=o[0],a[1]-=o[1],se()}J=[t.clientX,t.clientY]});document.addEventListener("keyup",t=>{t.shiftKey||(ce=!1)});document.addEventListener("keydown",t=>{if(t.shiftKey&&(ce=!0),t.key=="e"&&(t.preventDefault(),t.shiftKey?(p=Math.min(Math.max(p-1,0),Z),document.getElementById("blockPicker").style.display="none",document.querySelector("#Block > img").style.backgroundColor=l.blockTexts[l.blocks[p]],document.getElementById("helper").innerText="Selected "+(z.b[p]||l.blocks[p]),document.getElementById("helper").style.top="8vh",W.forEach(r=>{try{clearInterval(r)}catch{}}),W.push(setTimeout(()=>{document.getElementById("helper").style.top="0vh"},1e3))):t.altKey?(p=Math.min(Math.max(p+1,0),Z),document.getElementById("blockPicker").style.display="none",document.querySelector("#Block > img").style.backgroundColor=l.blockTexts[l.blocks[p]],document.getElementById("helper").innerText="Selected "+(z.b[p]||l.blocks[p]),document.getElementById("helper").style.top="8vh",W.forEach(r=>{try{clearInterval(r)}catch{}}),W.push(setTimeout(()=>{document.getElementById("helper").style.top="0vh"},1e3))):document.getElementById("blockPicker").style.display=="block"?document.getElementById("blockPicker").style.display="none":document.getElementById("blockPicker").style.display="block"),t.key=="q"&&(t.preventDefault(),t.altKey&&(p=Math.min(Math.max(p-1,0),Z),document.getElementById("blockPicker").style.display="none",document.querySelector("#Block > img").style.backgroundColor=l.blockTexts[l.blocks[p]],document.getElementById("helper").innerText="Selected "+(z.b[p]||l.blocks[p]),document.getElementById("helper").style.top="8vh",W.forEach(r=>{try{clearInterval(r)}catch{}}),W.push(setTimeout(()=>{document.getElementById("helper").style.top="0vh"},1e3)))),t.key=="Escape"&&(t.preventDefault(),document.getElementById("blockPicker").style.display="none"),t.key=="z"&&t.ctrlKey){t.preventDefault();var o=re.pop();o&&o.type=="brush"&&(o.r.forEach(r=>{n.worldData.world.matrix[r[1]][r[0]]=r[2],g.RR||(E.fillStyle=Q(r[2]),r[2]==0&&(E.fillStyle="rgba(127,255,212,1)"),E.fillRect(r[0]*e,r[1]*e,e,e))}),g.RR&&V())}t.key=="v"&&!t.ctrlKey&&!t.shiftKey&&!t.altKey&&(t.preventDefault(),I=4),t.key=="b"&&!t.ctrlKey&&!t.shiftKey&&!t.altKey&&(t.preventDefault(),I=2),t.key=="n"&&!t.ctrlKey&&!t.shiftKey&&!t.altKey&&(t.preventDefault(),I=3),(t.key=="m"||t.key=="c")&&!t.ctrlKey&&!t.shiftKey&&!t.altKey&&(t.preventDefault(),I=1),t.key=="p"&&!t.ctrlKey&&!t.shiftKey&&!t.altKey&&(t.preventDefault(),_=!_)});addEventListener("wheel",function(t){if(n.worldData)if(t.deltaY>0){if(ee||t.shiftKey){w=Math.max(w-1,1),this.document.getElementById("Size").innerText=w+"px";return}var o=Math.round(Math.round((-a[0]+innerWidth/2)/(innerWidth*B)*Math.floor(i.width/e)))*e,r=Math.round(Math.round((-a[1]+innerHeight/2)/(innerHeight*B)*Math.floor(i.height/e)))*e;B=Math.max(.2,B-.1),a[0]-=.2*B*(o-Math.round(Math.round((-a[0]+innerWidth/2)/(innerWidth*B)*Math.floor(i.width/e)))*e),a[1]-=.2*B*(r-Math.round(Math.round((-a[1]+innerHeight/2)/(innerHeight*B)*Math.floor(i.height/e)))*e),a[0]+=(t.clientX-innerWidth/2)/this.window.innerWidth*50,a[1]+=(t.clientY-innerHeight/2)/this.window.innerHeight*50,se()}else{if(ee||t.shiftKey){w+=1,this.document.getElementById("Size").innerText=w+"px";return}var o=Math.round(Math.round((-a[0]+innerWidth/2)/(innerWidth*B)*Math.floor(i.width/e)))*e,r=Math.round(Math.round((-a[1]+innerHeight/2)/(innerHeight*B)*Math.floor(i.height/e)))*e;B=Math.min(24,B+.1),a[0]+=.2*B*(Math.round(Math.round((-a[0]+innerWidth/2)/(innerWidth*B)*Math.floor(i.width/e)))*e-o),a[1]+=.2*B*(Math.round(Math.round((-a[1]+innerHeight/2)/(innerHeight*B)*Math.floor(i.height/e)))*e-r),a[0]-=(t.clientX-innerWidth/2)/this.window.innerWidth*50,a[1]-=(t.clientY-innerHeight/2)/this.window.innerHeight*50,se()}});var ie=0;function Be(){if(ae++,new Date().getTime()-fe>=1e3&&(j=ae,ae=0,fe=new Date().getTime(),document.getElementById("fps").innerText=j-1+"fps"),n.worldData&&(me(),g.RR&&$!=0&&new Date().getTime()-$>2e3&&(document.getElementById("helper").innerText="Reloading!",document.getElementById("helper").style.top="8vh",W.forEach(t=>{try{clearInterval(t)}catch{}}),W.push(setTimeout(()=>{document.getElementById("helper").style.top="0vh"},1e3)),W.push(setTimeout(()=>{V()},510)),$=0),pe!=e&&(i.width=n.worldData.world.matrix[0].length*e,i.height=n.worldData.world.matrix.length*e,X.width=n.worldData.world.matrix[0].length*e,X.height=n.worldData.world.matrix.length*e,le.width=n.worldData.world.matrix[0].length*e,le.height=n.worldData.world.matrix.length*e,ie=i.width/i.height,V(),pe=e,he&&(he=!1)),de.forEach(t=>{t.type==1&&E.drawImage(l.tileImages[l.structures[t.struct.type]].img,l.tileImages[l.structures[t.struct.type]].width*(Math.floor(oe/j/ge)%(l.tileImages[l.structures[t.struct.type]].tiles||[1,0])[0]),0,l.tileImages[l.structures[t.struct.type]].width,l.tileImages[l.structures[t.struct.type]].height,t.struct.x*e,t.struct.y*e,4*e*(l.tileImages[l.structures[t.struct.type]].xScaler||1),4*e*(l.tileImages[l.structures[t.struct.type]].yScaler||1))}),oe++,i.style.width=innerWidth*B+"px",i.style.height=innerWidth*ie*B+"px",X.style.width=innerWidth*B+"px",X.style.height=innerWidth*ie*B+"px",le.style.width=innerWidth*B+"px",le.style.height=innerWidth*ie*B+"px"),_?document.getElementById("mv").style.backgroundColor="blue":document.getElementById("mv").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("move").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("brush").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("erase").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("rect").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("Block").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("blockPicker").style.display=="block"&&(document.getElementById("Block").style.backgroundColor="orange"),!_)switch(I){case 1:document.getElementById("move").style.backgroundColor="blue";break;case 2:document.getElementById("brush").style.backgroundColor="blue";break;case 3:document.getElementById("rect").style.backgroundColor="blue";break;case 4:document.getElementById("erase").style.backgroundColor="blue";break}ee||ce?document.getElementById("Size").style.backgroundColor="orange":document.getElementById("Size").style.backgroundColor="rgba(0,0,0,0.5)",ke()}Be();setInterval(scroll,500,0,0);document.getElementById("mv").onclick=()=>{_=!_};document.getElementById("move").onclick=()=>{I=1};document.getElementById("brush").onclick=()=>{I=2};document.getElementById("erase").onclick=()=>{I=4};document.getElementById("Block").onclick=()=>{document.getElementById("blockPicker").style.display="block"};document.getElementById("Size").onpointerenter=()=>{ee=!0};document.getElementById("Size").onpointerleave=()=>{ee=!1};document.getElementById("set").onclick=()=>{document.getElementById("settings").style.display="block",document.getElementById("ac").style.display="block"};document.getElementById("rect").onclick=()=>{I=3};function Fe(){var t=document.getElementById("ei").style.backgroundColor=="green",o=document.getElementById("structi").checked,r=document.getElementById("compi").checked;document.getElementById("export").innerHTML="",r&&alert("Compression not finished, maybe V1.0"),setTimeout(()=>{if(t){var c=!1;document.getElementById("export").innerHTML='<canvas id="ft" title="Game,   LMB to save, RMB to copy" style="cursor: pointer;"></canvas><canvas id="fw" title="Game w/ sky,LMB to save, RMB to copy" style="cursor: pointer;"></canvas><canvas id="lw" title="Load,   LMB to save, RMB to copy" style="cursor: pointer;"></canvas><canvas id="sw" title="Shadow, LMB to save, RMB to copy" style="cursor: pointer;"></canvas><canvas id="aw" title="Auth,   LMB to save, RMB to copy" style="cursor: pointer;"></canvas><p id="failedSmText" style="display:none">Some Blocks failed in LoadMap, replaced with SandSoil</p>',document.getElementById("fw").onmouseenter=()=>{R=1},document.getElementById("ft").onmouseenter=()=>{R=5},document.getElementById("lw").onmouseenter=()=>{R=2},document.getElementById("sw").onmouseenter=()=>{R=3},document.getElementById("aw").onmouseenter=()=>{R=4},document.getElementById("fw").onmouseleave=()=>R=0,document.getElementById("ft").onmouseleave=()=>R=0,document.getElementById("lw").onmouseleave=()=>R=0,document.getElementById("sw").onmouseleave=()=>R=0,document.getElementById("aw").onmouseleave=()=>R=0,document.getElementById("fw").width=n.worldData.world.matrix.length,document.getElementById("fw").height=n.worldData.world.matrix[0].length,document.getElementById("ft").width=n.worldData.world.matrix.length,document.getElementById("ft").height=n.worldData.world.matrix[0].length,document.getElementById("lw").width=n.worldData.world.matrix.length,document.getElementById("lw").height=n.worldData.world.matrix[0].length,document.getElementById("sw").width=n.worldData.world.matrix.length,document.getElementById("sw").height=n.worldData.world.matrix[0].length,document.getElementById("aw").width=n.worldData.world.matrix.length,document.getElementById("aw").height=n.worldData.world.matrix[0].length;var d=document.getElementById("fw").getContext("2d"),h=document.getElementById("ft").getContext("2d");d.fillStyle="rgb(20,175,245)",d.drawImage(l.tileImages.BackGround.img,0,0,document.getElementById("fw").width,document.getElementById("fw").height),n.worldData.world.matrix.forEach((s,v)=>{var b=0,y=null,L=0;if(s.forEach((k,H)=>{var te=Q(k);if(H<s.length)if(typeof k=="number"&&(y==null||y==k)){b++,y==null&&(y=k,L=H);return}else{var x=l.blockTexts[l.blocks[y]];x||(x=l.particleTexts[l.particles[y-100]]),d.fillStyle=x,h.fillStyle=x,d.fillRect(L,v,b,1),h.fillRect(L,v,b,1),y=null,b=0}k!=0&&(d.fillStyle=te,h.fillStyle=te,d.fillRect(H,v,1,1),h.fillRect(H,v,1,1))}),y!=null){var D=l.blockTexts[l.blocks[y]];D||(D=l.particleTexts[l.particles[y-100]]),d.fillStyle=D,h.fillStyle=D,d.fillRect(L,v,b,1),h.fillRect(L,v,b,1)}}),n.worldData.structures.forEach(s=>{l.structures[s.type]&&l.tileImages[l.structures[s.type]]&&(Ie.includes(s.type),d.drawImage(l.tileImages[l.structures[s.type]].img,l.tileImages[l.structures[s.type]].width,0,l.tileImages[l.structures[s.type]].width,l.tileImages[l.structures[s.type]].height,s.x,s.y,4*(l.tileImages[l.structures[s.type]].xScaler||1),4*(l.tileImages[l.structures[s.type]].yScaler||1)),h.drawImage(l.tileImages[l.structures[s.type]].img,l.tileImages[l.structures[s.type]].width,0,l.tileImages[l.structures[s.type]].width,l.tileImages[l.structures[s.type]].height,s.x,s.y,4*(l.tileImages[l.structures[s.type]].xScaler||1),4*(l.tileImages[l.structures[s.type]].yScaler||1)))}),d=document.getElementById("lw").getContext("2d"),d.fillStyle="rgb(255,255,255)",d.fillRect(0,0,document.getElementById("lw").width,document.getElementById("lw").height),n.worldData.world.matrix.forEach((s,v)=>{var b=0,y=null,L=0;if(s.forEach((k,H)=>{if(k!=0){var te=Q(k,T);if(H<s.length)if(typeof k=="number"&&(y==null||y==k)){b++,y==null&&(y=k,L=H);return}else{var x=T.blockTexts[T.blocks[y]];x||(x=T.particleTexts[T.particles[y-100]]),d.fillStyle=x,d.fillRect(L,v,b,1),y=null,b=0}k!=0&&(d.fillStyle=te,d.fillRect(H,v,1,1),y=null,b=0)}else if(y!=null){var x=T.blockTexts[T.blocks[y]];x||(x=T.particleTexts[T.particles[y-100]]),d.fillStyle=x,d.fillRect(L,v,b,1),y=null,b=0}}),y!=null){var D=T.blockTexts[T.blocks[y]];D||(D=T.particleTexts[T.particles[y-100]]),d.fillStyle=D,d.fillRect(L,v,b,1)}});var m=performance.now();d=document.getElementById("sw").getContext("2d"),d.fillStyle="rgb(0,0,0)",n.worldData.world.matrix.forEach((s,v)=>{var b=0,y=null,L=0;s.forEach((D,k)=>{if(D==0||D==6||D==103)y!=null&&(d.fillRect(L,v,b,1),y=null,b=0);else{if(k<s.length)if(typeof D=="number"&&(y==null||y==D)){b++,y==null&&(y=D,L=k);return}else d.fillRect(L,v,b,1),y=null,b=0;d.fillRect(k,v,1,1)}}),y!=null&&d.fillRect(L,v,b,1)}),c&&(document.getElementById("failedSmText").style.display="block")}else{var M=JSON.parse(JSON.stringify(n.saveData)),u=JSON.parse(JSON.stringify(n.worldData));if(o||u.structures&&(u.structures={}),r)document.getElementById("export").style.display="none",document.getElementById("ac").style.display="none";else{var f=JSON.stringify(M)+`\n`+JSON.stringify(u),F=document.createElement("a");F.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(f)),F.setAttribute("download",(n.saveData.name||"Save")+".save"),F.style.display="none",document.body.appendChild(F),F.click(),document.body.removeChild(F),document.getElementById("ac").style.display="none",document.getElementById("export").style.display="none"}}},15)}function Re(){document.getElementById("ac").style.display="none",document.getElementById("export").style.display="none",document.getElementById("export").innerHTML=""}Object.keys(Me).forEach(t=>{if(t==0){document.getElementById("blockPicker").innerHTML+=`<button title="Air" id="${t}" onclick="select(self)" style="background-color:rgb(0,0,0);border: none;border-radius: 10%;color:white">Air</button>`;return}document.getElementById("blockPicker").innerHTML+=`<button title="${l.blocks[t]}" id="${t}" onclick="select(this)" style="background-color:${l.blockTexts[l.blocks[t]]};border: none;border-radius: 10%;">${z.b[t]||l.blocks[t]}</button>`});document.getElementById("es").onclick=()=>{document.getElementById("ac").style.display="block",document.getElementById("export").style.display="block",document.getElementById("export").innerHTML='<p id="menuObj">Export</p><hr><button id="close">X</button><button id="ef" style="background-color:green"><u>File</u></button><button id="ei" style="background-color:white"><u>Image</u></button><br><label alt="enabling compression will not allow you to load it in game." id="strcu"><input type="checkbox" checked="true" title="structures" id="structi">Save Structures?</label><br><label alt="enabling compression will not allow you to load it in game." id="comp"><input type="checkbox" title="compression(danger)" id="compi">Compress?<br><strong id="warn" style="color: red;">ENABLING COMPRESSION WILL NOT ALLOW YOU TO LOAD IT IN GAME.<br>PURELY FOR SAVING MOMENTS WITHOUT TAKING LOTS OF STORAGE,<br>can be used to make game saves smaller<br>if you want to take snapshots of editing progress or your game!</strong></label><button id="EPS">Export!</button>',document.getElementById("ef").onclick=()=>{document.getElementById("ef").style.backgroundColor="green",document.getElementById("ei").style.backgroundColor="white",document.getElementById("comp").style.display="block",document.getElementById("strcu").style.display="block"},document.getElementById("ei").onclick=()=>{document.getElementById("ei").style.backgroundColor="green",document.getElementById("ef").style.backgroundColor="white",document.getElementById("comp").style.display="none",document.getElementById("strcu").style.display="none"},document.getElementById("EPS").onclick=Fe,document.querySelector("#export>#close").onclick=Re};function O(){switch(document.getElementById("rendstruct").checked=g.OS,document.getElementById("outline").checked=g.OL,document.getElementById("rerender").checked=g.RR,document.getElementById("tooltip").checked=g.TT,document.getElementById("toghelp").checked=g.TH,document.getElementById("DW").checked=g.DW,document.getElementById("PP").checked=!1,document.getElementById("LP").checked=!1,document.getElementById("LQ").checked=!1,document.getElementById("NQ").checked=!1,document.getElementById("HQ").checked=!1,g.RQ){case 1:document.getElementById("PP").checked=!0,e=.9;break;case 2:document.getElementById("LP").checked=!0,e=1;break;case 3:document.getElementById("LQ").checked=!0,e=2;break;case 4:document.getElementById("NQ").checked=!0,e=3;break;case 5:document.getElementById("HQ").checked=!0,e=4;break}g.TT?document.getElementById("ToolTip").style.display="block":document.getElementById("ToolTip").style.display="none",g.TH?document.getElementById("helper").style.display="block":document.getElementById("helper").style.display="none"}document.getElementById("rendstruct").onclick=()=>{g.OS=!g.OS,V(),O()};document.getElementById("outline").onclick=()=>{g.OL=!g.OL,V(),O()};document.getElementById("rerender").onclick=()=>{g.RR=!g.RR,O()};document.getElementById("tooltip").onclick=()=>{g.TT=!g.TT,O()};document.getElementById("toghelp").onclick=()=>{g.TH=!g.TH,O()};document.getElementById("PP").onclick=()=>{g.RQ=1,O()};document.getElementById("LP").onclick=()=>{g.RQ=2,O()};document.getElementById("LQ").onclick=()=>{g.RQ=3,O()};document.getElementById("NQ").onclick=()=>{g.RQ=4,O()};document.getElementById("HQ").onclick=()=>{g.RQ=5,O()};document.getElementById("DW").onclick=()=>{g.DW=!g.DW,O()};document.getElementById("RL").onclick=()=>{document.getElementById("helper").innerText="Reloading!",document.getElementById("helper").style.top="8vh",W.forEach(t=>{try{clearInterval(t)}catch{}}),W.push(setTimeout(()=>{document.getElementById("helper").style.top="0vh"},1e3)),W.push(setTimeout(()=>{V()},510))};document.getElementById("setsave").onclick=()=>{localStorage.setItem("settings",JSON.stringify(g)),document.getElementById("settings").style.display="none",document.getElementById("ac").style.display="none"};O();
