var a={},r=document.getElementById("editor"),V=document.getElementById("nonwipemask"),k=r.getContext("2d"),A=document.getElementById("nonwipemask").getContext("2d"),le=document.getElementById("transparent"),_=document.getElementById("transparent").getContext("2d"),de=[],oe=0,j=60,ne=0,fe=new Date().getTime(),C=1,$=0,d={OS:!1,OL:!0,RR:!1,TT:!0,TH:!0,DW:!1,RQ:4};function ke(){requestAnimationFrame(ve)}if(localStorage.getItem("settings"))try{d=JSON.parse(localStorage.getItem("settings"))}catch{localStorage.setItem("settings",JSON.stringify(d))}else localStorage.setItem("settings",JSON.stringify(d));d||(d={});d.OS||(d.OS=!1);d.OL||(d.OL=!0);d.RR||(d.RR=!1);d.TT||(d.TT=!0);d.TH||(d.TH=!0);d.DW||(d.DW=!1);d.RQ||(d.RQ=4);localStorage.setItem("settings",JSON.stringify(d));var x=[],ie=[],Y=[],Ee=10,e=3,pe=0,ge=.5,se=!1,g=[0,0],G=!1,ee=!1,ce=!1,ae=!1,E=[-1,-1],w=5,I=1,p=1,F=0;_.globalAlpha=.1;function Se(t){alert(t)}function ve(){Be()}async function q(t){try{let o=await new Promise((c,n)=>{t.toBlob(c,"image/png")}),i=new ClipboardItem({"image/png":o});await navigator.clipboard.write([i])}catch(o){alert("failed: "+o)}}function U(t){var o=t.toDataURL(),i=document.createElement("a");i.download="canvas_image.png",i.href=o,i.click()}function we(t){t&&F>0&&(F==1&&document.getElementById("fw")&&(t==1?U(document.getElementById("fw")):t==2&&q(document.getElementById("fw"))),F==2&&document.getElementById("lw")&&(t==1?U(document.getElementById("lw")):t==2&&q(document.getElementById("lw"))),F==3&&document.getElementById("sw")&&(t==1?U(document.getElementById("sw")):t==2&&q(document.getElementById("sw"))),F==4&&document.getElementById("aw")&&(t==1?U(document.getElementById("aw")):t==2&&q(document.getElementById("aw"))),F==5&&document.getElementById("ft")&&(t==1?U(document.getElementById("ft")):t==2&&q(document.getElementById("ft"))))}document.getElementById("loadFS").onchange=()=>{be(document.getElementById("loadFS"))};document.getElementById("backgroundGrabber").onchange=()=>{be(document.getElementById("backgroundGrabber"))};async function be(t){if(t.files[0]){var o=new FileReader;o.readAsText(t.files[0]),o.onload=i=>{try{se=!0,a={saveData:JSON.parse(i.target.result.split(`\n`)[0]),worldData:JSON.parse(i.target.result.split(`\n`)[1])},document.getElementById("menu").style.display="none",document.getElementById("ac").style.display="none",d.DW||(document.getElementById("helper").innerText="Welcome, use RMB or MMB to move the camera, or use LMB with the move tool.",document.getElementById("helper").style.top="8vh",setTimeout(()=>{document.getElementById("helper").style.top="0vh",setTimeout(()=>{document.getElementById("helper").innerText="Theres an array of tools at the top,hover on a tool to get more info,fullscreen recommended(f11)",document.getElementById("helper").style.top="8vh",setTimeout(()=>{document.getElementById("helper").style.top="0vh"},5e3)},700)},1e4))}catch(c){Se(c)}},o.onerror=()=>{alert("failed to read")}}}var Me={0:"Empty",1:"Element",2:"SandSoil",3:"SporeSoil",4:"Fog",5:"FogJetpackBlock",6:"FogWater",7:"FreezingIceSoil",8:"Divider",9:"Grass",10:"Moss",11:"GoldSoil",12:"Petal",13:"FogLava",14:"Fluxite",15:"Block",16:"SlidingBlock",23:"Bedrock",25:"Ice",26:"Grower",27:"NascentWater",28:"SandiumSoil",29:"Obsidian",30:"Crackstone"},l={blockTexts:{Empty:"rgba(0,0,0,0)",Element:"rgb(255, 0, 0)",SandSoil:"rgb(210,167,106)",SporeSoil:"rgb(119,147,37)",Fog:"rgb(102,204,255)",FogJetpackBlock:"rgb(0, 13, 255)",FogWater:"rgb(154, 240, 253)",FreezingIceSoil:"rgb(238,246,246)",Divider:"rgb(255, 128, 0)",Grass:"rgb(115,177,67)",Moss:"rgb(91,206,34)",GoldSoil:"rgb(255, 255, 0)",Petal:"rgb(70,37,147)",FogLava:"rgb(184, 70, 70)",Fluxite:"rgb(184, 18, 239)",Block:"rgb(194, 200, 34)",SlidingBlock:"rgb(217, 255, 0)",SlidingBlockLeft:"rgb(255, 0, 238)",SlidingBlockRight:"rgb(0, 255, 195)",ConveyorLeft:"rgb(61, 43, 43)",ConveyorRight:"rgb(84, 93, 58)",ShakerLeft:"rgb(97, 88, 88)",ShakerRight:"rgb(97, 88, 88)",Bedrock:"rgb(168,168,168)",VelocitySoaker:"rgb(107, 120, 49)",Ice:"rgb(204,239,255)",Grower:"rgb(124, 91, 19)",NascentWater:"rgb(0, 242, 247)",SandiumSoil:"rgb(163,0,0)",Obsidian:"rgb(77,0,0)",Crackstone:"rgb(224,211,184)",Slag:"rgb(126, 126, 126)",BurntSlag:"rgb(57, 57, 57)",BGWater:"rgb(65, 115, 252)"},particleTexts:{Sand:"rgb(255, 207, 86)",Particle:"rgb(0,0,0)",Water:"rgb(10, 250, 238)",WetSand:"rgb(184,126,46)",Sandium:"rgb(215, 24, 24)",Slag:"rgb(126, 126, 126)",Gold:"rgb(239, 224, 11)",Gloom:"rgb(0, 210, 186)",Shake:"rgb(255, 128, 0)",Steam:"rgba(31, 166, 144, 0.42)",Fire:"rgb(234, 131, 5)",FreezingIce:"rgb(41, 181, 213)",Flame:"rgb(215, 62, 15)",BurntSlag:"rgb(56, 56, 56)",Spore:"rgb(97, 200, 116)",WetSpore:"rgb(30, 133, 49)",Seed:"rgb(102, 74, 22)",Petalium:"rgb(135, 20, 181)",Lava:"rgb(235, 19, 19)",Basalt:"rgb(39, 33, 33)"},tileImages:{player:{img:"./tiles/player",width:18,height:34},block:{img:"./tiles/block",width:4,height:4},ConveyorLeft:{img:"./tiles/conveyor_left",width:16,height:16,tiles:[4,0]},ConveyorRight:{img:"./tiles/conveyor_right",width:16,height:16,tiles:[4,0]},ShakerLeft:{img:"./tiles/shaker_left",width:16,height:22,tiles:[2,0]},ShakerRight:{img:"./tiles/shaker_right",width:16,height:22,tiles:[2,0]},LauncherUp:{img:"./tiles/launcher",width:18,height:18},LauncherLeft:{img:"./tiles/launcher_left",width:18,height:26,yScaler:1.4444444444},LauncherRight:{img:"./tiles/launcher_right",width:18,height:26,yScaler:1.444444444},SplitterLeft:{img:"./tiles/splitter_left",width:7,height:4},SplitterRight:{img:"./tiles/splitter_right",width:7,height:4},Foundation:{img:"./tiles/block",width:4,height:4},FoundationAngledLeft:{img:"./tiles/triangle_left",width:4,height:4},FoundationTriangleLeftDel:{img:"./tiles/triangle_left_del",width:4,height:4},FoundationAngledRight:{img:"./tiles/triangle_right",width:4,height:4},FoundationTriangleRightDel:{img:"./tiles/triangle_right_del",width:4,height:4},Collector:{img:"./tiles/sell",width:16,height:16,tiles:[4,0],opacity:1},FilterLeft:{img:"./tiles/filter_left",width:18,height:18,tiles:[4,0]},FilterRight:{img:"./tiles/filter_right",width:18,height:18,tiles:[4,0]},VelocitySoaker:{img:"./tiles/velocity",width:18,height:417,yScaler:23.166666666666,opacity:.3},Grower:{img:"./tiles/farm",width:18,height:18},SoundBox:{img:"./tiles/sound_box",width:16,height:16},Pump:{img:"./tiles/pump",width:16,height:16},LiquidVent:{img:"./tiles/liquid_vent",width:16,height:16},Light:{img:"./tiles/light",width:16,height:16},GloomEmitter:{img:"./tiles/gloom_emitter",width:16,height:16},BackGround:{img:"./tiles/mountains_tiling_4x",width:3963,height:1024}},blocks:{0:"Empty",1:"Element",2:"SandSoil",3:"SporeSoil",4:"Fog",5:"FogJetpackBlock",6:"FogWater",7:"FreezingIceSoil",8:"Divider",9:"Grass",10:"Moss",11:"GoldSoil",12:"Petal",13:"FogLava",14:"Fluxite",15:"Block",16:"SlidingBlock",17:"SlidingBlockLeft",18:"SlidingBlockRight",19:"ConveyorLeft",20:"ConveyorRight",21:"ShakerLeft",22:"ShakerRight",23:"Bedrock",24:"VelocitySoaker",25:"Ice",26:"Grower",27:"NascentWater",28:"SandiumSoil",29:"Obsidian",30:"Crackstone"},particles:{1:"Sand",2:"Particle",3:"Water",4:"WetSand",5:"Sandium",6:"Slag",7:"Gold",8:"Gloom",9:"Shake",10:"Steam",11:"Fire",12:"FreezingIce",13:"Flame",14:"BurntSlag",15:"Spore",16:"WetSpore",17:"Seed",18:"Petalium",19:"Lava",20:"Basalt"},structures:{1:"ConveyorLeft",2:"ConveyorRight",3:"ShakerLeft",4:"ShakerRight",5:"LauncherUp",6:"LauncherLeft",7:"LauncherRight",8:"SplitterLeft",9:"SplitterRight",10:"Dropper",11:"Foundation",12:"FoundationAngledLeft",13:"FoundationTriangleLeftDel",14:"FoundationAngledRight",15:"FoundationTriangleRightDel",16:"Collector",17:"FilterLeft",18:"FilterRight",19:"SlidingFoundation",20:"VelocitySoaker",21:"Grower",22:"SoundBox",23:"Pipe",24:"Pump",25:"LiquidVent",26:"Light",27:"GloomEmitter"}},D={blockTexts:{Empty:"rgb(255,255,255)",Element:"rgb(0,0,0)",SandSoil:"rgb(0,0,0)",SporeSoil:"rgb(255,255,0)",Fog:"rgb(153,51,0)",FogJetpackBlock:"rgb(255,0,153)",FogWater:"rgb(153,102,255)",FreezingIceSoil:"rgb(204,255,255)",Divider:"rgb(0,102,0)",Grass:"rgb(0,255,0)",Moss:"rgb(0,224,0)",GoldSoil:"rgb(0,0,0)",Petal:"rgb(0,0,0)",FogLava:"rgb(0,0,0)",Fluxite:"rgb(175,0,224)",Block:"rgb(0,0,0)",SlidingBlock:"rgb(0,0,0)",SlidingBlockLeft:"rgb(0,0,0)",SlidingBlockRight:"rgb(0,0,0)",ConveyorLeft:"rgb(0,0,0)",ConveyorRight:"rgb(0,0,0)",ShakerLeft:"rgb(0,0,0)",ShakerRight:"rgb(0,0,0)",Bedrock:"rgb(170,170,170)",VelocitySoaker:"rgb(0,0,0)",Ice:"rgb(102,204,255)",Grower:"rgb(0,0,0)",NascentWater:"rgb(0,0,0)",SandiumSoil:"rgb(0,0,0)",Obsidian:"rgb(0,0,0)",Crackstone:"rgb(205,109,109)",Slag:"rgb(0,0,0)",BurntSlag:"rgb(0,0,0)",BGWater:"rgb(0,0,0)"},particleTexts:{Sand:"rgb(218,171,105)",Particle:"rgb(0,0,0)",Water:"rgb(102,0,255)",WetSand:"rgb(186,127,46)",Sandium:"rgb(188,33,33)",Slag:"rgb(174,174,174)",Gold:"rgb(250,250,2)",Gloom:"rgb(103,102,102)",Shake:"rgb()",Steam:"rgb(255,255,204)",Fire:"rgb()",FreezingIce:"rgb(204,204,204)",Flame:"rgb()",BurntSlag:"rgb(98,98,98)",Spore:"rgb(190,218,105)",WetSpore:"rgb(150,186,46)",Seed:"rgb(70,153,26)",Petalium:"rgb(139,105,218)",Lava:"rgb(255,174,11)",Basalt:"rgb(117,10,0)"},tileImages:{player:{img:"./tiles/player",width:18,height:34},block:{img:"./tiles/block",width:4,height:4},ConveyorLeft:{img:"./tiles/conveyor_left",width:16,height:16,tiles:[4,0]},ConveyorRight:{img:"./tiles/conveyor_right",width:16,height:16,tiles:[4,0]},ShakerLeft:{img:"./tiles/shaker_left",width:16,height:22,tiles:[2,0]},ShakerRight:{img:"./tiles/shaker_right",width:16,height:22,tiles:[2,0]},LauncherUp:{img:"./tiles/launcher",width:18,height:18},LauncherLeft:{img:"./tiles/launcher_left",width:18,height:26,yScaler:1.4444444444},LauncherRight:{img:"./tiles/launcher_right",width:18,height:26,yScaler:1.444444444},SplitterLeft:{img:"./tiles/splitter_left",width:7,height:4},SplitterRight:{img:"./tiles/splitter_right",width:7,height:4},Foundation:{img:"./tiles/block",width:4,height:4},FoundationAngledLeft:{img:"./tiles/triangle_left",width:4,height:4},FoundationTriangleLeftDel:{img:"./tiles/triangle_left_del",width:4,height:4},FoundationAngledRight:{img:"./tiles/triangle_right",width:4,height:4},FoundationTriangleRightDel:{img:"./tiles/triangle_right_del",width:4,height:4},Collector:{img:"./tiles/sell",width:16,height:16,tiles:[4,0],opacity:1},FilterLeft:{img:"./tiles/filter_left",width:18,height:18,tiles:[4,0]},FilterRight:{img:"./tiles/filter_right",width:18,height:18,tiles:[4,0]},VelocitySoaker:{img:"./tiles/velocity",width:18,height:417,yScaler:23.166666666666,opacity:.3},Grower:{img:"./tiles/farm",width:18,height:18},SoundBox:{img:"./tiles/sound_box",width:16,height:16},Pump:{img:"./tiles/pump",width:16,height:16},LiquidVent:{img:"./tiles/liquid_vent",width:16,height:16},Light:{img:"./tiles/light",width:16,height:16},GloomEmitter:{img:"./tiles/gloom_emitter",width:16,height:16}},blocks:{0:"Empty",1:"Element",2:"SandSoil",3:"SporeSoil",4:"Fog",5:"FogJetpackBlock",6:"FogWater",7:"FreezingIceSoil",8:"Divider",9:"Grass",10:"Moss",11:"GoldSoil",12:"Petal",13:"FogLava",14:"Fluxite",15:"Block",16:"SlidingBlock",17:"SlidingBlockLeft",18:"SlidingBlockRight",19:"ConveyorLeft",20:"ConveyorRight",21:"ShakerLeft",22:"ShakerRight",23:"Bedrock",24:"VelocitySoaker",25:"Ice",26:"Grower",27:"NascentWater",28:"SandiumSoil",29:"Obsidian",30:"Crackstone"},particles:{1:"Sand",2:"Particle",3:"Water",4:"WetSand",5:"Sandium",6:"Slag",7:"Gold",8:"Gloom",9:"Shake",10:"Steam",11:"Fire",12:"FreezingIce",13:"Flame",14:"BurntSlag",15:"Spore",16:"WetSpore",17:"Seed",18:"Petalium",19:"Lava",20:"Basalt"},structures:{1:"ConveyorLeft",2:"ConveyorRight",3:"ShakerLeft",4:"ShakerRight",5:"LauncherUp",6:"LauncherLeft",7:"LauncherRight",8:"SplitterLeft",9:"SplitterRight",10:"Dropper",11:"Foundation",12:"FoundationAngledLeft",13:"FoundationTriangleLeftDel",14:"FoundationAngledRight",15:"FoundationTriangleRightDel",16:"Collector",17:"FilterLeft",18:"FilterRight",19:"SlidingFoundation",20:"VelocitySoaker",21:"Grower",22:"SoundBox",23:"Pipe",24:"Pump",25:"LiquidVent",26:"Light",27:"GloomEmitter"}},Ie=[5,6,7,11,12,13,14,15,20,24,25,26],H={p:{12:"Ice/Frozen Water",14:"Burnt Slag",16:"Wet Spore",13:"Fire",4:"Wet Sand"},b:{0:"Air",5:"JetPack BG",2:"Sand Soil",3:"Spore Soil",6:"Hazy Water",7:"Snow",11:"Golden Soil",13:"Hazy Lava",14:"Flux/Fluxite",16:"Sliding Block",17:"Sliding Block (Left)",18:"Sliding Block (Right)",19:"Conveyor (Left)",20:"Conveyor (Right)",21:"Shaker (Left)",22:"Shaker (Right)",24:"Kinematic Press",27:"Nascent Water",28:"Sandium Soil"}};Object.keys(l.tileImages).forEach(t=>{var o=new Image;o.src=l.tileImages[t].img+".png",l.tileImages[t].img=o});var Z=0;Object.keys(l.blocks).forEach(t=>{Z=Math.max(Z,t)});function Q(t,o=l){var i=o.blockTexts[o.blocks[t]];if(i||(i=o.particleTexts[o.particles[t-100]]),typeof t=="object")if(Array.isArray(t)){var c={r:[],g:[],b:[],a:[]};t.forEach(u=>{var f=o.blockTexts[o.blocks[u]];f||(f=o.particleTexts[o.particles[u-100]]),typeof f=="string"&&f.startsWith("rgba")?(c.r.push(parseFloat(f.substring(5,f.length-1).split(",")[0])),c.g.push(parseFloat(f.substring(5,f.length-1).split(",")[1])),c.b.push(parseFloat(f.substring(5,f.length-1).split(",")[2])),c.a.push(parseFloat(f.substring(5,f.length-1).split(",")[3]))):(c.r.push(parseFloat(f.substring(5,f.length-1).split(",")[0])),c.g.push(parseFloat(f.substring(5,f.length-1).split(",")[1])),c.b.push(parseFloat(f.substring(5,f.length-1).split(",")[2])),c.a.push(1))});var[n,s,m,v]=[0,0,0,0];c.r.map(u=>{n+=u||0}),n/=c.r.length,c.g.map(u=>{s+=u||0}),s/=c.g.length,c.b.map(u=>{m+=u||0}),m/=c.b.length,c.a.map(u=>{v+=u||1}),v/=c.a.length,i="rgba("+n+","+s+","+m+","+v+")"}else t=t.element.type,i=o.particleTexts[o.particles[t]];return i}function X(){if(de=[],a.worldData){k.clearRect(0,0,r.width,r.height),_.clearRect(0,0,r.width,r.height);var t=performance.now();d.OS||a.worldData.world.matrix.forEach((o,i)=>{var c=0,n=null,s=0;if(o.forEach((v,u)=>{if(v!=0){d.OL&&d.RQ>2&&(_.fillStyle="rgba(0, 0, 0, 0.5)",a.worldData.world.matrix[i-1]&&a.worldData.world.matrix[i-1][u]==0&&_.fillRect(u*e,(i-1)*e+e*.75,e,e/4),a.worldData.world.matrix[i+1]&&a.worldData.world.matrix[i+1][u]==0&&_.fillRect(u*e,(i+1)*e+e/8,e,e/4),a.worldData.world.matrix[i]&&a.worldData.world.matrix[i][u-1]==0&&_.fillRect((u-1)*e+e*.75,i*e,e/4,e),a.worldData.world.matrix[i]&&a.worldData.world.matrix[i][u+1]==0&&_.fillRect((u+1)*e+e/8,i*e,e/4,e));var f=Q(v);if(u<o.length)if(typeof v=="number"&&(n==null||n==v)){c++,n==null&&(n=v,s=u);return}else{var M=l.blockTexts[l.blocks[n]];M||(M=l.particleTexts[l.particles[n-100]]),k.fillStyle=M,k.fillRect(s*e,i*e,e*c,e),n=null,c=0}v!=0&&(k.fillStyle=f,k.fillRect(u*e,i*e,e,e))}else if(n!=null){var M=l.blockTexts[l.blocks[n]];M||(M=l.particleTexts[l.particles[n-100]]),k.fillStyle=M,k.fillRect(s*e,i*e,e*c,e),n=null,c=0}}),n!=null){var m=l.blockTexts[l.blocks[n]];m||(m=l.particleTexts[l.particles[n-100]]),k.fillStyle=m,k.fillRect(s*e,i*e,e*c,e)}}),a.worldData.structures.forEach(o=>{l.structures[o.type]&&l.tileImages[l.structures[o.type]]&&(Ie.includes(o.type)?k.drawImage(l.tileImages[l.structures[o.type]].img,l.tileImages[l.structures[o.type]].width*(Math.floor(oe/j/ge)%(l.tileImages[l.structures[o.type]].tiles||[1,0])[0]),0,l.tileImages[l.structures[o.type]].width,l.tileImages[l.structures[o.type]].height,o.x*e,o.y*e,4*e*(l.tileImages[l.structures[o.type]].xScaler||1),4*e*(l.tileImages[l.structures[o.type]].yScaler||1)):(k.drawImage(l.tileImages[l.structures[o.type]].img,l.tileImages[l.structures[o.type]].width*(Math.floor(oe/j/ge)%(l.tileImages[l.structures[o.type]].tiles||[1,0])[0]),0,l.tileImages[l.structures[o.type]].width,l.tileImages[l.structures[o.type]].height,o.x*e,o.y*e,4*e*(l.tileImages[l.structures[o.type]].xScaler||1),4*e*(l.tileImages[l.structures[o.type]].yScaler||1)),de.push({type:1,struct:o})))}),document.getElementById("RL").innerText=Math.floor(performance.now()-t)+"ms",setTimeout(()=>{document.getElementById("RL").innerText="Refresh Viewport"},1500)}}var[O,P]=[0,0];function me(t){if(a.worldData){if(A.clearRect(0,0,V.width,V.height),G&&A.drawImage(l.tileImages.player.img,Math.round((-g[0]+O)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e)*e),Math.round((-g[1]+P)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e)*e),l.tileImages.player.width,l.tileImages.player.height),A.drawImage(l.tileImages.player.img,a.worldData.player.x*e/8,a.worldData.player.y*e/8,18/4*e,34/4*e),(I==2||I==4)&&!G&&document.getElementById("ac").style.display=="none"&&document.getElementById("blockPicker").style.display=="none"){A.fillStyle="rgba(0,0,0,1)",A.strokeRect(Math.round((-g[0]+O)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e)*e)-e*w/2,Math.round((-g[1]+P)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e)*e)-e*w/2,e*w,e*w);var o="rgba(",i=l.blockTexts[l.blocks[p]];o+=parseFloat(i.replaceAll("rgba(","").replaceAll("rgb(","").substring(0,i.length-1).split(",")[0])+",",o+=parseFloat(i.replaceAll("rgba(","").replaceAll("rgb(","").substring(0,i.length-1).split(",")[1])+",",o+=parseFloat(i.replaceAll("rgba(","").replaceAll("rgb(","").substring(0,i.length-1).split(",")[2])+",",A.fillStyle=o+"0.5)",A.fillRect(Math.round((-g[0]+O)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e)*e)-e*w/2,Math.round((-g[1]+P)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e)*e)-e*w/2,e*w,e*w);var c=p;if(I==4&&(p=0),ae&&t){if($=new Date().getTime(),t){let u=J[0],f=J[1],M=O-u,h=P-f,S=Math.abs(M)/1,b=Math.abs(h)/1,y=M!==0?1*Math.sign(M):0,R=h!==0?1*Math.sign(h):0,L=Math.max(S,b);for(let B=0;B<=L;B++){var s=Math.round(Math.round((-g[0]+u)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e))-w/2),m=Math.round(Math.round((-g[1]+f)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e))-w/2);for(let K=m;K<m+w;K++)for(let z=s;z<s+w;z++)if(z>=0&&K>=0&&z<a.worldData.world.matrix[0].length&&K<a.worldData.world.matrix.length){var n=!1;if(Y.forEach(ye=>{ye[0]==z&&ye[1]==K&&(n=!0)}),n)continue;Y.push([z,K,a.worldData.world.matrix[K][z]]),a.worldData.world.matrix[K][z]=p}var v=Q(p);p==0&&(v="rgb(127,255,212)"),k.fillStyle=v,k.fillRect(s*e,m*e,e*w,e*w),d.OL&&_.clearRect(s*e,m*e,e*w,e*w),I==4&&(p=c),B<=S&&(u+=y),B<=b&&(f+=R)}}var s=Math.round(Math.round((-g[0]+O)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e))-w/2),m=Math.round(Math.round((-g[1]+P)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e))-w/2);for(let u=m;u<m+w;u++)for(let f=s;f<s+w;f++)if(f>=0&&u>=0&&f<a.worldData.world.matrix[0].length&&u<a.worldData.world.matrix.length){var n=!0;Y.forEach(h=>{h[0]==f&&h[1]==u&&(n=!1)}),n&&Y.push([f,u,a.worldData.world.matrix[u][f]]),a.worldData.world.matrix[u][f]=p}var v=Q(p);p==0&&(v="rgb(127,255,212)"),k.fillStyle=v,k.fillRect(s*e,m*e,e*w,e*w),d.OL&&_.clearRect(s*e,m*e,e*w,e*w),I==4&&(p=c)}}I==3&&ae&&(A.fillStyle="rgba(0,0,0,1)",A.strokeRect(Math.round(Math.round((-g[0]+E[0])/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e)))*e,Math.round(Math.round((-g[1]+E[1])/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e)))*e,(Math.round(Math.round((-g[0]+O)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e)))-Math.round(Math.round((-g[0]+E[0])/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e))))*e,(Math.round(Math.round((-g[1]+P)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e)))-Math.round(Math.round((-g[1]+E[1])/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e))))*e))}}addEventListener("mousemove",t=>{if(a.worldData){var o="None";if(a.worldData.world.matrix[Math.round((-g[1]+t.clientY)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e))]&&a.worldData.world.matrix[Math.round((-g[1]+t.clientY)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e))][Math.round((-g[0]+t.clientX)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e))]){var i=a.worldData.world.matrix[Math.round((-g[1]+t.clientY)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e))][Math.round((-g[0]+t.clientX)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e))];typeof i=="number"?i>100?l.particles[i-100]&&(o=H.p[i-100]||l.particles[i-100]):l.blocks[i]&&(o=H.b[i]||l.blocks[i]):typeof i=="object"&&(Array.isArray(i)?o="Overlapping Blocks":i&&(i.element.type>100?l.particles[i.element.type-100]&&(o="Launched "+(H.p[i.element.type-100]||l.particles[i.element.type-100])):l.blocks[i.element.type]&&(o="Launched "+(H.p[i.element.type]||l.particles[i.element.type]))))}document.getElementById("ToolTip").innerText="X:"+Math.round((-g[0]+t.clientX)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e))+",Y:"+Math.round((-g[1]+t.clientY)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e))+`\nBlock:`+o}});var ue=!1,J=[];function he(){document.getElementById("editor").style.left=g[0]+"px",document.getElementById("editor").style.top=g[1]+"px",document.getElementById("nonwipemask").style.left=g[0]+"px",document.getElementById("nonwipemask").style.top=g[1]+"px",document.getElementById("transparent").style.left=g[0]+"px",document.getElementById("transparent").style.top=g[1]+"px"}addEventListener("mousedown",t=>{t.buttons==1&&F>0&&we(1),t.buttons==2&&F>0&&we(2),t.buttons==1&&t.clientY/window.innerHeight>=.08&&!G&&(ae=!0,E=[t.clientX,t.clientY]),(I==1&&t.buttons==1||t.buttons==4||t.buttons==2)&&document.getElementById("ac").style.display=="none"&&(t.preventDefault(),J=[t.clientX,t.clientY],ue=!0),t.buttons==1&&G&&(G=!1,a.worldData.player.x=Math.round((-g[0]+t.clientX)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e))*8,a.worldData.player.y=Math.round((-g[1]+t.clientY)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e))*8,a.worldData.player.velocity.x=0,a.worldData.player.velocity.y=0),O=t.clientX,P=t.clientY,J=[t.clientX,t.clientY],(I==2||I==4)&&me(!0)});addEventListener("mouseup",t=>{if(I==2&&t.button==0&&Y.length>0&&(ie.push({type:"brush",r:Y}),Y=[],ie.length>Ee&&ie.shift()),I==3&&t.button==0&&t.clientY/window.innerHeight>.08&&E[0]>=0&&E[1]>=0){$=new Date().getTime(),k.fillStyle=Q(p);var o=Math.round(Math.round((-g[0]+E[0])/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e))),i=Math.round(Math.round((-g[1]+E[1])/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e))),c=Math.round(Math.round((-g[0]+O)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e)))-Math.round(Math.round((-g[0]+E[0])/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e))),n=Math.round(Math.round((-g[1]+P)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e)))-Math.round(Math.round((-g[1]+E[1])/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e)));if(i>i+n&&o<o+c)for(let s=i;s>i+n;s--)for(let m=o;m<o+c;m++)m>=0&&s>=0&&m<a.worldData.world.matrix[0].length&&s<a.worldData.world.matrix.length&&(a.worldData.world.matrix[s][m]=p);else if(o>o+c&&i<i+n)for(let s=i;s<i+n;s++)for(let m=o;m>o+c;m--)m>=0&&s>=0&&m<a.worldData.world.matrix[0].length&&s<a.worldData.world.matrix.length&&(a.worldData.world.matrix[s][m]=p);else if(o>o+c&&i>i+n)for(let s=i;s>i+n;s--)for(let m=o;m>o+c;m--)m>=0&&s>=0&&m<a.worldData.world.matrix[0].length&&s<a.worldData.world.matrix.length&&(a.worldData.world.matrix[s][m]=p);else for(let s=i;s<i+n;s++)for(let m=o;m<o+c;m++)m>=0&&s>=0&&m<a.worldData.world.matrix[0].length&&s<a.worldData.world.matrix.length&&(a.worldData.world.matrix[s][m]=p);d.OL&&_.clearRect(Math.round(Math.round((-g[0]+E[0])/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e)))*e,Math.round(Math.round((-g[1]+E[1])/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e)))*e,(Math.round(Math.round((-g[0]+O)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e)))-Math.round(Math.round((-g[0]+E[0])/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e))))*e,(Math.round(Math.round((-g[1]+P)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e)))-Math.round(Math.round((-g[1]+E[1])/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e))))*e),k.fillRect(Math.round(Math.round((-g[0]+E[0])/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e)))*e,Math.round(Math.round((-g[1]+E[1])/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e)))*e,(Math.round(Math.round((-g[0]+O)/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e)))-Math.round(Math.round((-g[0]+E[0])/parseFloat(r.style.width.substring(0,r.style.width.length-2))*Math.floor(r.width/e))))*e,(Math.round(Math.round((-g[1]+P)/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e)))-Math.round(Math.round((-g[1]+E[1])/parseFloat(r.style.height.substring(0,r.style.height.length-2))*Math.floor(r.height/e))))*e)}t.button==0&&(ae=!1,E=[-1,-1]),(I==1||t.button!=0)&&(ue=!1)});addEventListener("mousemove",t=>{if(O=t.clientX,P=t.clientY,(I==2||I==4)&&me(!0),ue){var o=[J[0]-t.clientX,J[1]-t.clientY];g[0]-=o[0],g[1]-=o[1],he()}J=[t.clientX,t.clientY]});document.addEventListener("keyup",t=>{t.shiftKey||(ce=!1)});document.addEventListener("keydown",t=>{if(t.shiftKey&&(ce=!0),t.key=="e"&&(t.preventDefault(),t.shiftKey?(p=Math.min(Math.max(p-1,0),Z),document.getElementById("blockPicker").style.display="none",document.querySelector("#Block > img").style.backgroundColor=l.blockTexts[l.blocks[p]],document.getElementById("helper").innerText="Selected "+(H.b[p]||l.blocks[p]),document.getElementById("helper").style.top="8vh",x.forEach(i=>{try{clearInterval(i)}catch{}}),x.push(setTimeout(()=>{document.getElementById("helper").style.top="0vh"},1e3))):t.altKey?(p=Math.min(Math.max(p+1,0),Z),document.getElementById("blockPicker").style.display="none",document.querySelector("#Block > img").style.backgroundColor=l.blockTexts[l.blocks[p]],document.getElementById("helper").innerText="Selected "+(H.b[p]||l.blocks[p]),document.getElementById("helper").style.top="8vh",x.forEach(i=>{try{clearInterval(i)}catch{}}),x.push(setTimeout(()=>{document.getElementById("helper").style.top="0vh"},1e3))):document.getElementById("blockPicker").style.display=="block"?document.getElementById("blockPicker").style.display="none":document.getElementById("blockPicker").style.display="block"),t.key=="q"&&(t.preventDefault(),t.altKey&&(p=Math.min(Math.max(p-1,0),Z),document.getElementById("blockPicker").style.display="none",document.querySelector("#Block > img").style.backgroundColor=l.blockTexts[l.blocks[p]],document.getElementById("helper").innerText="Selected "+(H.b[p]||l.blocks[p]),document.getElementById("helper").style.top="8vh",x.forEach(i=>{try{clearInterval(i)}catch{}}),x.push(setTimeout(()=>{document.getElementById("helper").style.top="0vh"},1e3)))),t.key=="Escape"&&(t.preventDefault(),document.getElementById("blockPicker").style.display="none"),t.key=="z"&&t.ctrlKey){t.preventDefault();var o=ie.pop();o&&o.type=="brush"&&(o.r.forEach(i=>{a.worldData.world.matrix[i[1]][i[0]]=i[2],d.RR||(k.fillStyle=Q(i[2]),i[2]==0&&(k.fillStyle="rgba(127,255,212,1)"),k.fillRect(i[0]*e,i[1]*e,e,e))}),d.RR&&X())}t.key=="v"&&!t.ctrlKey&&!t.shiftKey&&!t.altKey&&(t.preventDefault(),I=4),t.key=="b"&&!t.ctrlKey&&!t.shiftKey&&!t.altKey&&(t.preventDefault(),I=2),t.key=="n"&&!t.ctrlKey&&!t.shiftKey&&!t.altKey&&(t.preventDefault(),I=3),(t.key=="m"||t.key=="c")&&!t.ctrlKey&&!t.shiftKey&&!t.altKey&&(t.preventDefault(),I=1),t.key=="p"&&!t.ctrlKey&&!t.shiftKey&&!t.altKey&&(t.preventDefault(),G=!G)});addEventListener("wheel",function(t){if(a.worldData)if(t.deltaY>0){if(ee||t.shiftKey){w=Math.max(w-1,1),this.document.getElementById("Size").innerText=w+"px";return}C=Math.max(.2,C-.1),g[0]-=r.width*e*.1/512-window.innerWidth/512,g[1]-=r.width*e*.1/512-window.innerWidth/512,he()}else{if(ee||t.shiftKey){w+=1,this.document.getElementById("Size").innerText=w+"px";return}C=Math.min(24,C+.1),g[0]+=r.width*e*.1/512-window.innerWidth/512,g[1]+=r.width*e*.1/512-window.innerWidth/512,he()}});var re=0;function Be(){if(ne++,new Date().getTime()-fe>=1e3&&(j=ne,ne=0,fe=new Date().getTime(),document.getElementById("fps").innerText=j-1+"fps"),a.worldData&&(me(),d.RR&&$!=0&&new Date().getTime()-$>2e3&&(document.getElementById("helper").innerText="Reloading!",document.getElementById("helper").style.top="8vh",x.forEach(t=>{try{clearInterval(t)}catch{}}),x.push(setTimeout(()=>{document.getElementById("helper").style.top="0vh"},1e3)),x.push(setTimeout(()=>{X()},510)),$=0),pe!=e&&(r.width=a.worldData.world.matrix[0].length*e,r.height=a.worldData.world.matrix.length*e,V.width=a.worldData.world.matrix[0].length*e,V.height=a.worldData.world.matrix.length*e,le.width=a.worldData.world.matrix[0].length*e,le.height=a.worldData.world.matrix.length*e,re=r.width/r.height,X(),pe=e,se&&(se=!1)),de.forEach(t=>{t.type==1&&k.drawImage(l.tileImages[l.structures[t.struct.type]].img,l.tileImages[l.structures[t.struct.type]].width*(Math.floor(oe/j/ge)%(l.tileImages[l.structures[t.struct.type]].tiles||[1,0])[0]),0,l.tileImages[l.structures[t.struct.type]].width,l.tileImages[l.structures[t.struct.type]].height,t.struct.x*e,t.struct.y*e,4*e*(l.tileImages[l.structures[t.struct.type]].xScaler||1),4*e*(l.tileImages[l.structures[t.struct.type]].yScaler||1))}),oe++,r.style.width=innerWidth*C+"px",r.style.height=innerWidth*re*C+"px",V.style.width=innerWidth*C+"px",V.style.height=innerWidth*re*C+"px",le.style.width=innerWidth*C+"px",le.style.height=innerWidth*re*C+"px"),G?document.getElementById("mv").style.backgroundColor="blue":document.getElementById("mv").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("move").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("brush").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("erase").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("rect").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("Block").style.backgroundColor="rgba(0,0,0,0.5)",document.getElementById("blockPicker").style.display=="block"&&(document.getElementById("Block").style.backgroundColor="orange"),!G)switch(I){case 1:document.getElementById("move").style.backgroundColor="blue";break;case 2:document.getElementById("brush").style.backgroundColor="blue";break;case 3:document.getElementById("rect").style.backgroundColor="blue";break;case 4:document.getElementById("erase").style.backgroundColor="blue";break}ee||ce?document.getElementById("Size").style.backgroundColor="orange":document.getElementById("Size").style.backgroundColor="rgba(0,0,0,0.5)",ke()}Be();setInterval(scroll,500,0,0);document.getElementById("mv").onclick=()=>{G=!G};document.getElementById("move").onclick=()=>{I=1};document.getElementById("brush").onclick=()=>{I=2};document.getElementById("erase").onclick=()=>{I=4};document.getElementById("Block").onclick=()=>{document.getElementById("blockPicker").style.display="block"};document.getElementById("Size").onpointerenter=()=>{ee=!0};document.getElementById("Size").onpointerleave=()=>{ee=!1};document.getElementById("set").onclick=()=>{document.getElementById("settings").style.display="block",document.getElementById("ac").style.display="block"};document.getElementById("rect").onclick=()=>{I=3};function Fe(){var t=document.getElementById("ei").style.backgroundColor=="green",o=document.getElementById("structi").checked,i=document.getElementById("compi").checked;document.getElementById("export").innerHTML="",i&&alert("Compression not finished, maybe V1.0"),setTimeout(()=>{if(t){var c=!1;document.getElementById("export").innerHTML=`<canvas id="ft" title="Game,   LMB to save, RMB to copy" style="cursor: pointer;"></canvas><canvas id="fw" title="Game w/ sky,LMB to save, RMB to copy" style="cursor: pointer;"></canvas> <canvas id="lw" title="Load,   LMB to save, RMB to copy" style="cursor: pointer;"></canvas><canvas id="sw" title="Shadow, LMB to save, RMB to copy" style="cursor: pointer;"></canvas><canvas id="aw" title="Auth,   LMB to save, RMB to copy" style="cursor: pointer;"></canvas><p id="failedSmText" style="display:none">Some Blocks failed in LoadMap, replaced with SandSoil</p>`,document.getElementById("fw").onmouseenter=()=>{F=1},document.getElementById("ft").onmouseenter=()=>{F=5},document.getElementById("lw").onmouseenter=()=>{F=2},document.getElementById("sw").onmouseenter=()=>{F=3},document.getElementById("aw").onmouseenter=()=>{F=4},document.getElementById("fw").onmouseleave=()=>F=0,document.getElementById("ft").onmouseleave=()=>F=0,document.getElementById("lw").onmouseleave=()=>F=0,document.getElementById("sw").onmouseleave=()=>F=0,document.getElementById("aw").onmouseleave=()=>F=0,document.getElementById("fw").width=a.worldData.world.matrix.length,document.getElementById("fw").height=a.worldData.world.matrix[0].length,document.getElementById("ft").width=a.worldData.world.matrix.length,document.getElementById("ft").height=a.worldData.world.matrix[0].length,document.getElementById("lw").width=a.worldData.world.matrix.length,document.getElementById("lw").height=a.worldData.world.matrix[0].length,document.getElementById("sw").width=a.worldData.world.matrix.length,document.getElementById("sw").height=a.worldData.world.matrix[0].length,document.getElementById("aw").width=a.worldData.world.matrix.length,document.getElementById("aw").height=a.worldData.world.matrix[0].length;var n=document.getElementById("fw").getContext("2d"),s=document.getElementById("ft").getContext("2d");n.fillStyle="rgb(20,175,245)",n.drawImage(l.tileImages.BackGround.img,0,0,document.getElementById("fw").width,document.getElementById("fw").height),a.worldData.world.matrix.forEach((h,S)=>{var b=0,y=null,R=0;if(h.forEach((B,N)=>{var te=Q(B);if(N<h.length)if(typeof B=="number"&&(y==null||y==B)){b++,y==null&&(y=B,R=N);return}else{var T=l.blockTexts[l.blocks[y]];T||(T=l.particleTexts[l.particles[y-100]]),n.fillStyle=T,s.fillStyle=T,n.fillRect(R,S,b,1),s.fillRect(R,S,b,1),y=null,b=0}B!=0&&(n.fillStyle=te,s.fillStyle=te,n.fillRect(N,S,1,1),s.fillRect(N,S,1,1))}),y!=null){var L=l.blockTexts[l.blocks[y]];L||(L=l.particleTexts[l.particles[y-100]]),n.fillStyle=L,s.fillStyle=L,n.fillRect(R,S,b,1),s.fillRect(R,S,b,1)}}),a.worldData.structures.forEach(h=>{l.structures[h.type]&&l.tileImages[l.structures[h.type]]&&(Ie.includes(h.type),n.drawImage(l.tileImages[l.structures[h.type]].img,l.tileImages[l.structures[h.type]].width,0,l.tileImages[l.structures[h.type]].width,l.tileImages[l.structures[h.type]].height,h.x,h.y,4*(l.tileImages[l.structures[h.type]].xScaler||1),4*(l.tileImages[l.structures[h.type]].yScaler||1)),s.drawImage(l.tileImages[l.structures[h.type]].img,l.tileImages[l.structures[h.type]].width,0,l.tileImages[l.structures[h.type]].width,l.tileImages[l.structures[h.type]].height,h.x,h.y,4*(l.tileImages[l.structures[h.type]].xScaler||1),4*(l.tileImages[l.structures[h.type]].yScaler||1)))}),n=document.getElementById("lw").getContext("2d"),n.fillStyle="rgb(255,255,255)",n.fillRect(0,0,document.getElementById("lw").width,document.getElementById("lw").height),a.worldData.world.matrix.forEach((h,S)=>{var b=0,y=null,R=0;if(h.forEach((B,N)=>{if(B!=0){var te=Q(B,D);if(N<h.length)if(typeof B=="number"&&(y==null||y==B)){b++,y==null&&(y=B,R=N);return}else{var T=D.blockTexts[D.blocks[y]];T||(T=D.particleTexts[D.particles[y-100]]),n.fillStyle=T,n.fillRect(R,S,b,1),y=null,b=0}B!=0&&(n.fillStyle=te,n.fillRect(N,S,1,1),y=null,b=0)}else if(y!=null){var T=D.blockTexts[D.blocks[y]];T||(T=D.particleTexts[D.particles[y-100]]),n.fillStyle=T,n.fillRect(R,S,b,1),y=null,b=0}}),y!=null){var L=D.blockTexts[D.blocks[y]];L||(L=D.particleTexts[D.particles[y-100]]),n.fillStyle=L,n.fillRect(R,S,b,1)}});var m=performance.now();n=document.getElementById("sw").getContext("2d"),n.fillStyle="rgb(0,0,0)",a.worldData.world.matrix.forEach((h,S)=>{var b=0,y=null,R=0;h.forEach((L,B)=>{if(L==0||L==6||L==103)y!=null&&(n.fillRect(R,S,b,1),y=null,b=0);else{if(B<h.length)if(typeof L=="number"&&(y==null||y==L)){b++,y==null&&(y=L,R=B);return}else n.fillRect(R,S,b,1),y=null,b=0;n.fillRect(B,S,1,1)}}),y!=null&&n.fillRect(R,S,b,1)}),c&&(document.getElementById("failedSmText").style.display="block")}else{var v=JSON.parse(JSON.stringify(a.saveData)),u=JSON.parse(JSON.stringify(a.worldData));if(o||u.structures&&(u.structures={}),i)document.getElementById("export").style.display="none",document.getElementById("ac").style.display="none";else{var f=JSON.stringify(v)+`\n`+JSON.stringify(u),M=document.createElement("a");M.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(f)),M.setAttribute("download",(a.saveData.name||"Save")+".save"),M.style.display="none",document.body.appendChild(M),M.click(),document.body.removeChild(M),document.getElementById("ac").style.display="none",document.getElementById("export").style.display="none"}}},15)}function Re(){document.getElementById("ac").style.display="none",document.getElementById("export").style.display="none",document.getElementById("export").innerHTML=""}Object.keys(Me).forEach(t=>{if(t==0){document.getElementById("blockPicker").innerHTML+=`<button title="Air" id="${t}" onclick="select(self)" style="background-color:rgb(0,0,0);border: none;border-radius: 10%;color:white">Air</button>`;return}document.getElementById("blockPicker").innerHTML+=`<button title="${l.blocks[t]}" id="${t}" onclick="select(this)" style="background-color:${l.blockTexts[l.blocks[t]]};border: none;border-radius: 10%;">${H.b[t]||l.blocks[t]}</button>`});document.getElementById("es").onclick=()=>{document.getElementById("ac").style.display="block",document.getElementById("export").style.display="block",document.getElementById("export").innerHTML=`<p id="menuObj">Export</p><hr><button id="close">X</button><button id="ef" style="background-color:green"><u>File</u></button><button id="ei" style="background-color:white"><u>Image</u></button><br><label alt="enabling compression will not allow you to load it in game." id="strcu"><input type="checkbox" checked="true" title="structures" id="structi">Save Structures?</label><br><label alt="enabling compression will not allow you to load it in game." id="comp"><input type="checkbox" title="compression(danger)" id="compi">Compress?<br><strong id="warn" style="color: red;">ENABLING COMPRESSION WILL NOT ALLOW YOU TO LOAD IT IN GAME.<br>PURELY FOR SAVING MOMENTS WITHOUT TAKING LOTS OF STORAGE,<br>can be used to make game saves smaller<br>if you want to take snapshots of editing progress or your game!</strong></label><button id="EPS">Export!</button>`,document.getElementById("ef").onclick=()=>{document.getElementById("ef").style.backgroundColor="green",document.getElementById("ei").style.backgroundColor="white",document.getElementById("comp").style.display="block",document.getElementById("strcu").style.display="block"},document.getElementById("ei").onclick=()=>{document.getElementById("ei").style.backgroundColor="green",document.getElementById("ef").style.backgroundColor="white",document.getElementById("comp").style.display="none",document.getElementById("strcu").style.display="none"},document.getElementById("EPS").onclick=Fe,document.querySelector("#export>#close").onclick=Re};function W(){switch(document.getElementById("rendstruct").checked=d.OS,document.getElementById("outline").checked=d.OL,document.getElementById("rerender").checked=d.RR,document.getElementById("tooltip").checked=d.TT,document.getElementById("toghelp").checked=d.TH,document.getElementById("DW").checked=d.DW,document.getElementById("PP").checked=!1,document.getElementById("LP").checked=!1,document.getElementById("LQ").checked=!1,document.getElementById("NQ").checked=!1,document.getElementById("HQ").checked=!1,d.RQ){case 1:document.getElementById("PP").checked=!0,e=.9;break;case 2:document.getElementById("LP").checked=!0,e=1;break;case 3:document.getElementById("LQ").checked=!0,e=2;break;case 4:document.getElementById("NQ").checked=!0,e=3;break;case 5:document.getElementById("HQ").checked=!0,e=4;break}d.TT?document.getElementById("ToolTip").style.display="block":document.getElementById("ToolTip").style.display="none",d.TH?document.getElementById("helper").style.display="block":document.getElementById("helper").style.display="none"}document.getElementById("rendstruct").onclick=()=>{d.OS=!d.OS,X(),W()};document.getElementById("outline").onclick=()=>{d.OL=!d.OL,X(),W()};document.getElementById("rerender").onclick=()=>{d.RR=!d.RR,W()};document.getElementById("tooltip").onclick=()=>{d.TT=!d.TT,W()};document.getElementById("toghelp").onclick=()=>{d.TH=!d.TH,W()};document.getElementById("PP").onclick=()=>{d.RQ=1,W()};document.getElementById("LP").onclick=()=>{d.RQ=2,W()};document.getElementById("LQ").onclick=()=>{d.RQ=3,W()};document.getElementById("NQ").onclick=()=>{d.RQ=4,W()};document.getElementById("HQ").onclick=()=>{d.RQ=5,W()};document.getElementById("DW").onclick=()=>{d.DW=!d.DW,W()};document.getElementById("RL").onclick=()=>{document.getElementById("helper").innerText="Reloading!",document.getElementById("helper").style.top="8vh",x.forEach(t=>{try{clearInterval(t)}catch{}}),x.push(setTimeout(()=>{document.getElementById("helper").style.top="0vh"},1e3)),x.push(setTimeout(()=>{X()},510))};document.getElementById("setsave").onclick=()=>{localStorage.setItem("settings",JSON.stringify(d)),document.getElementById("settings").style.display="none",document.getElementById("ac").style.display="none"};W();
